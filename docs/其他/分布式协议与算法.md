- [分布式基础理论](#ll)
  - [拜占庭问题](#bzt)
  - [CAP](#cap)
  - [ACID](#acid)
  - [BASE](#base)

- [分布式协议和算法](#xy)
  - [Paxos算法](#Paxos)
  - [Raft算法](#Raft)
  - [一致性Hash算法](#hash)
  - [Gossip协议](#Gossip)



# <a id="ll">分布式基础理论</a>

### <a id="bzt">拜占庭问题</a>

- 介绍

拜占庭问题是Leslie Lamport在1982年提出的分布式领域最复杂的容错模型，主要用来讨论和论证分布式共识问题。

- 描述

拜占庭作为东罗马帝国的首都，地域辽阔，在首都周边有众多将军负责城防，将军之间通过信使来传递消息，达成某些一致的决定。

但由于将军中存在叛徒，叛徒会想尽一切办法干扰一致性的达成，甚至是达成叛徒想要的共识从而伪造消息。

拜占庭问题即是如何在可能有误导信息的情况下，采取合适的通讯机制，让多个将军达成一致，制定一致性的作战计划。

- 示例

**情景一：**

假设将军总数3，叛徒将军数1

提案人不是叛徒，提案人发送一个提案，叛徒收到后，回复不同的命令，对于第三个将军就收到两个相反的消息，也无法判断出谁是叛徒，系统无法达成一致。

![image-20200411213446238](C:\Users\67409\AppData\Roaming\Typora\typora-user-images\image-20200411213446238.png)

> A是提案人，C是叛徒，B收到相反的消息，无法达成一致

提案人是叛徒，发送两个相反的提案给另外两个，另外两个收到两个相反的消息，无法判断究竟谁是叛徒，系统无法达成一致。

![image-20200411213717851](C:\Users\67409\AppData\Roaming\Typora\typora-user-images\image-20200411213717851.png)

> C是叛徒，发送两个不同的提案，导致AB都收到不同的提案，无法达成一致

**情景二：**

假设将军总数4，叛徒将军数1

提案人不是叛徒，提案人发送一个提案，叛徒同样作恶，但另外两个将军收到正确的提案数还是大于错误提案数（2T1F），然后就能发现叛徒，踢出叛徒再进行一次投票即可实现一致性

![image-20200411214108265](C:\Users\67409\AppData\Roaming\Typora\typora-user-images\image-20200411214108265.png)

> A是提案人，C是叛徒

提案人是叛徒，提案人发送不同的提案，另外三个将军沟通后，也能达成一致

![image-20200411214526228](C:\Users\67409\AppData\Roaming\Typora\typora-user-images\image-20200411214526228.png)

> C是叛徒且提案，给A提案T，给B和C提案F，最终A，B，D达到一致性状态F

- 结论

拜占庭将军问题论证了想要实现分布式共识，可以通过以下两种方式：

- 消息签名机制，即将军之间可以彼此识别假消息，识别出叛徒
- 新增忠诚将军数量，假设叛徒的个数为m，忠诚将军的数量必须大于等于3m+1，且经过m+1轮投票可以达成一致

由于第一种方式实现较为困难，因此一般拜占庭将军问题也指的是：

**n位将军，最多容忍(n-1)/3个叛徒**

> 将此故事与分布式领域映射：
>
> - 将军代指的是不同的服务节点
>
> - 忠诚的将军代指的是正常运行的服务节点
> - 叛变的将军代指的是出现故障的服务节点
> - 信使被杀代指通讯故障，信息丢失
> - 信使被间谍替换代指通讯被中间人攻击，攻击者恶意伪造信息

在分布式场景中，拜占庭将军问题描述的是最困难，也是最复杂的一种分布式场景：**除了存在故障之外，还存在恶意行为的场景**。

在存在恶意节点行为的场景中（如数字货币的区块链技术），必须使用拜占庭容错算法（Byzantine Fault Tolerant，BFT）。BFT除了以上提到的两种解决方案外，常用的拜占庭容错算法还有：PBFT算法，PoW算法。

在计算机分布式系统中，最常用的是非拜占庭容错算法，即故障容错算法（Crash Fault Tolerance，CFT）。**CFT解决的是分布式系统中存在故障，但不存在恶意节点的场景下的共识问题**。即可能存在丢失消息，重复消息，但不存在错误消息或者伪造消息的情况。常见的算法有Paxos算法，Raft算法，ZAB协议等。

> 在实际应用中，如果能确定环境中节点可信，不存在恶意篡改，伪造信息情况，推荐使用非拜占庭算法

### <a id="cap">CAP理论</a>



### <a id="acid">ACID理论</a>



### <a id="base">BASE理论</a>











# <a id="xy">分布式协议和算法</a>





### <a id="Paxos">Paxos算法</a>



### <a id ="Raft">Raft算法</a>



### <a id="hash">一致性Hash算法</a>



### <a id="Gossip">Gossip协议</a>



